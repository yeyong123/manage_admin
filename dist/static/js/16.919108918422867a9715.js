webpackJsonp([16,41],{105:function(e,t,a){a(675);var r=a(31)(a(219),a(637),"data-v-649f511d",null);e.exports=r.exports},219:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{orders:[],page:{next_page:0,total_count:0,current_page:0},order:{},workflow_state:"",edit_id:"",dialogVisible:!1,q:"",state:"",company_id:"",company_list:[],start_time:"",end_time:"",current_action:"search",facilitator_id:"",customer_service_id:"",service_users:[],measured_users:[],loading:!1,states:[{value:null,label:"选择状态"},{value:"new",label:"新订单"},{value:"appointed_measurement",label:"预约测量"},{value:"measured",label:"已测量"},{value:"appointed_installation",label:"预约安装"},{value:"installed",label:"已安装"},{value:"confirm_installled",label:"确认安装"},{value:"completed",label:"已完成"},{value:"canceled",label:"已取消"}],pickerOptions2:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},time:[]}},created:function(){this.fetchResource(this.page.next_page)},methods:{fetchResource:function(e){var t=this;t.current_action="index",t.$http.get("orders.json?page="+e).then(function(e){t.orders=e.body.klass,t.page=e.body.page},function(e){t.$message.error("加载失败")})},handlePage:function(e){if("search"===this.current_action){var t={keyword:this.q,facilitator_id:this.facilitator_id,customer_service_id:this.customer_service_id,workflow_state:this.workflow_state,page:page.current_page,time:this.conver_time(this.time)};this.fetchSearch(t)}else this.fetchResource(e)},rowClick:function(e){this.$router.push("/orders/"+e)},searchQuery:function(){this.current_action="search";var e={keyword:this.q,facilitator_id:this.facilitator_id,customer_service_id:this.customer_service_id,workflow_state:this.workflow_state,time:this.conver_time(this.time)};this.fetchSearch(e)},fetchSearch:function(e){var t=this;this.$http.post("orders/search_orders",e).then(function(e){t.orders=e.body.klass,t.page=e.body.page})},conver_time:function(e){return this.time.map(function(e){return new Date(e).getTime()/1e3})},edit:function(e){var t=this;t.orders.forEach(function(a,r){if(e==a.id)return t.order=a,void(t.edit_id=e)}),t.dialogVisible=!0},editSubmit:function(e){var t=new FormData,a=this;for(var r in a.orde)t.append(r,a.order[r]);a.$http.put("orders/"+a.edit_id+".json",t).then(function(e){var t=e.body;if(t.code>200)return void a.$message.error(t.msg);a.$message("修改完成"),a.dialogVisible=!1},function(e){a.$message.error("加载失败")})},remoteUser2:function(e){var t=this;""!==e?(this.loading=!0,setTimeout(function(){t.loading=!1,t.$http.get("orders/users?keyword="+e).then(function(e){t.measured_users=e.body.users})},500)):(this.customer_service_id="",this.measured_users=[])},remoteUser:function(e){var t=this;""!==e?(this.loading=!0,setTimeout(function(){t.loading=!1,t.$http.get("orders/users?keyword="+e).then(function(e){t.service_users=e.body.users})},500)):(this.facilitator_id="",this.service_users=[])},orderState:function(e,t){var a="";switch(e.workflow_state){case"new":a="新订单";break;case"installed":a="已安装";break;case"canceled":a="已取消";break;case"completed":a="已完成";break;case"measured":a="已测量";break;case"appointed_installation":a="预约安装";break;case"appointed_measurement":a="预约测量";break;default:a="已取消"}return a}}}},335:function(e,t,a){t=e.exports=a(7)(),t.push([e.i,".search[data-v-649f511d]{width:200px;margin-bottom:15px}",""])},637:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v(" "),a("router-link",{attrs:{to:"/dashboard"}},[e._v("\n          主页\n          ")])],1),e._v(" "),a("el-breadcrumb-item",[e._v("订单列表")])],1)],1),e._v(" "),a("div",{staticClass:"user-header"},[a("form",[a("el-input",{staticClass:"search",attrs:{placeholder:"订单号或手机号"},model:{value:e.q,callback:function(t){e.q=t}}}),e._v(" "),a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions2,placeholder:"选择时间范围",format:"yyyy-MM-dd HH:mm:ss","range-separator":"/",align:"right"},model:{value:e.time,callback:function(t){e.time=t}}}),e._v(" "),a("el-select",{attrs:{filterable:"",remote:"",placeholder:"安装师傅","remote-method":e.remoteUser,loading:e.loading},model:{value:e.facilitator_id,callback:function(t){e.facilitator_id=t}}},e._l(e.service_users,function(e){return a("el-option",{key:e.real_name,attrs:{label:e.real_name,value:e.id}})})),e._v(" "),a("el-select",{attrs:{filterable:"",remote:"",placeholder:"测量师傅","remote-method":e.remoteUser2,loading:e.loading},model:{value:e.customer_service_id,callback:function(t){e.customer_service_id=t}}},e._l(e.measured_users,function(e){return a("el-option",{key:e.real_name,attrs:{label:e.real_name,value:e.id}})})),e._v(" "),a("el-select",{attrs:{placeholder:"选择状态"},model:{value:e.workflow_state,callback:function(t){e.workflow_state=t}}},e._l(e.states,function(e){return a("el-option",{attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchQuery}},[e._v("搜索")])],1)]),e._v(" "),a("p",[e._v("共: "+e._s(e.page.total_count))]),e._v(" "),a("el-table",{attrs:{data:e.orders,border:""}},[a("el-table-column",{attrs:{label:"订单号"},scopedSlots:e._u([["default",function(t){return[a("span",{on:{click:function(a){e.rowClick(t.row.id)}}},[e._v(e._s(t.row.serial_number))])]}]])}),e._v(" "),a("el-table-column",{attrs:{label:"发单人",width:"150"},scopedSlots:e._u([["default",function(t){return[e._v("\n           "+e._s(t.row.name)+"\n         ")]}]])}),e._v(" "),a("el-table-column",{attrs:{prop:"tel",label:"手机",width:"170"}}),e._v(" "),a("el-table-column",{attrs:{prop:"total",label:"预估总价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"city",label:"所在城市"}}),e._v(" "),a("el-table-column",{attrs:{prop:"region",label:"渠道"}}),e._v(" "),a("el-table-column",{attrs:{prop:"workflow_state",label:"进度",formatter:e.orderState}}),e._v(" "),a("el-table-column",{attrs:{label:"安装人"},scopedSlots:e._u([["default",function(t){return[a("a",{attrs:{link:{name:"users",params:{id:t.row.facilitator_id}}}},[e._v(e._s(t.row.service_info.name))])]}]])}),e._v(" "),a("el-table-column",{attrs:{prop:"customer_service_info.name",label:"测量人"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([["default",function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.rowClick(t.row.id)}}},[e._v("查看")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.edit(t.row.id)}}},[e._v("编辑")])]}]])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.page.current_page,"page-size":25,total:e.page.total_count},on:{"current-change":e.handlePage}})],1),e._v(" "),a("el-dialog",{attrs:{title:"订单处理"},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t}}},[a("el-form",{ref:"order",attrs:{inline:!0,model:e.order,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"订单号"}},[a("el-input",{attrs:{disabled:""},model:{value:e.order.serial_number,callback:function(t){e.order.serial_number=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"面积"}},[a("el-input",{model:{value:e.order.square,callback:function(t){e.order.square=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"省"}},[a("el-input",{model:{value:e.order.province,callback:function(t){e.order.province=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"市"}},[a("el-input",{model:{value:e.order.city,callback:function(t){e.order.city=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"区"}},[a("el-input",{model:{value:e.order.area,callback:function(t){e.order.area=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"街道"}},[a("el-input",{model:{value:e.order.street,callback:function(t){e.order.street=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人"}},[a("el-input",{model:{value:e.order.name,callback:function(t){e.order.name=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人手机"}},[a("el-input",{model:{value:e.order.tel,callback:function(t){e.order.tel=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"品牌商"}},[a("el-input",{model:{value:e.order.company_id,callback:function(t){e.order.company_id=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"测量人"}},[a("el-input",{model:{value:e.order.customer_service_id,callback:function(t){e.order.customer_service_id=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"安装人"}},[a("el-input",{model:{value:e.order.facilitator_id,callback:function(t){e.order.facilitator_id=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-input",{model:{value:e.order.workflow_state,callback:function(t){e.order.workflow_state=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"测量费"}},[a("el-input",{model:{value:e.order.measure_amount,callback:function(t){e.order.measure_amount=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"预估总价"}},[a("el-input",{model:{value:e.order.total,callback:function(t){e.order.total=t}}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editSubmit(e.edit_id)}}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}},675:function(e,t,a){var r=a(335);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(30)("1ce3a937",r,!0)}});